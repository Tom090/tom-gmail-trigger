"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.OperationExecutionFactory = void 0;
const HttpOperationExecutionFactory_1 = require("./HttpOperationExecutionFactory");
const CompositeOperationExecutionFactory_1 = require("./CompositeOperationExecutionFactory");
const OperationExecutionValidationFactory_1 = require("./OperationExecutionValidationFactory");
class OperationExecutionFactory {
    operationExecutionValidationFactory;
    httpOperationExecutionFactory;
    compositeOperationExecutionFactory;
    constructor(httpClient, fileStorage, operationHandlerInvocationFactory) {
        this.operationExecutionValidationFactory =
            new OperationExecutionValidationFactory_1.OperationExecutionValidationFactory();
        this.httpOperationExecutionFactory = new HttpOperationExecutionFactory_1.HttpOperationExecutionFactory(httpClient, fileStorage);
        this.compositeOperationExecutionFactory =
            new CompositeOperationExecutionFactory_1.CompositeOperationExecutionFactory(operationHandlerInvocationFactory);
    }
    executionFrom(handler) {
        const executionFromImplementation = this.executionFromImplementation(handler);
        const execution = this.operationExecutionValidationFactory.decorateExecution(executionFromImplementation, handler.validation);
        return execution;
    }
    executionFromImplementation(handler) {
        switch (handler.implementation._tag) {
            case 'HttpOperationHandler':
                return this.httpOperationExecutionFactory.executionFrom(handler.implementation, handler.globalConfiguration, handler.handlerType);
            case 'CompositeOperationHandler':
                return this.compositeOperationExecutionFactory.executionFrom(handler.implementation, handler.handlerType);
        }
    }
}
exports.OperationExecutionFactory = OperationExecutionFactory;
